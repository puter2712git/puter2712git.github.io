---
layout: post
title: "3. Camera"
date: 2025-08-19
categories: [uray_engine]
---

# 좌표계 구성

특정 오브젝트가 -1 ~ 1 사이의 범위인 **NDC**에서 렌더링될 때 여러 좌표계를 거쳐서 렌더링된다.

좌표계를 거쳐서 오브젝트를 transforming할 때 쓰이는 주요 행렬로는 **model**, **view**, **projection** matrix가 있다. 이 행렬들과의 연산을 통해 오브젝트는 **local coordinates**에서 **world coordinates**로, **world coordinates**에서 **view coordinates**로 변환되고 **clip coordinates**까지 거쳐 마지막으로 **screen coordinates**에서 보여지게 된다.

초기 오브젝트는 자신의 **local coordinates**에 위치한다. 이 범위는 초기 `vertices`로 지정한 값의 범위로 표현할 수 있다.

이후 **model** matrix 연산을 통해 오브젝트는 **world coordinates**에 위치한다. **world coordinates**는 모든 오브젝트가 있는 *world*에서 이 오브젝트가 상대적으로 어느 위치에 있는지를 표현한 좌표계이다. **model** matrix는 이 상대적 좌표를 표현하기 위해 오브젝트의 위치, 회전, 크기 등을 조정한다.

**world coordinates**에 위치한 오브젝트들을 개발자가 원하는 시야로 보여지게 하기 위해서는 이 오브젝트들을 **view coordinates**로 옮겨야 한다. 이는 **Camera**의 시점으로, **view** matrix는 **Camera**의 위치, 방향과 관련되어 있다.

**clip coordinates**는 카메라가 보는 시점 밖에 위치한 오브젝트를 *clipping*한다. **projection** matrix를 통해 *viewing box*라고 불리는 **frustum**을 생성하여 *clipping*을 수행한다.

따라서 위 프로세스를 적용한 소스 코드는 다음과 같다.

```cpp
uray::Camera* camera = new uray::Camera();

glm::mat4 model = glm::mat4(1.0f);
glm::mat4 projection;
projection = glm::perspective(glm::radians(45.0f), 800.0f / 600.0f, 0.1f, 100.0f);

// Render Loop
while (!glfwWindowShouldClose(window)) {
    ProcessInput(window);

    glClearColor(0.2f, 0.3f, 0.3f, 1.0f);
    glClear(GL_COLOR_BUFFER_BIT);

    glm::vec3 cameraPos = camera->GetPosition();
    cameraPos.x = sin(glfwGetTime()) * 10.0f;
    cameraPos.z = cos(glfwGetTime()) * 10.0f;
    cameraPos.y = 5.0f;
    camera->SetPosition(cameraPos);
    camera->UpdateViewMatrix();

    spriteShader->Use();
    spriteShader->SetMat4("model", model);
    spriteShader->SetMat4("view", camera->GetViewMatrix());
    spriteShader->SetMat4("projection", projection);
    spriteRenderer->Render();

    glfwSwapBuffers(window);
    glfwPollEvents();
}

delete spriteShader;
delete spriteRenderer;

// Clean GLFW's resources.
glfwTerminate();
return 0;
```

```cpp
#pragma once

#include <glm/glm.hpp>

namespace uray {
class Camera
{
public:
    Camera(glm::vec3 position = glm::vec3(0.0f, 0.0f, 3.0f),
           glm::vec3 target = glm::vec3(0.0f),
           glm::vec3 up = glm::vec3(0.0f, 1.0f, 0.0f));
    ~Camera();

    const glm::mat4& GetViewMatrix() const { return _viewMatrix; }
    void UpdateViewMatrix();

    const glm::vec3& GetPosition() const { return _position; }
    void SetPosition(const glm::vec3& position)
    {
        _position = position;
        _isDirty = true;
    }
    const glm::vec3& GetTarget() const { return _target; }
    void SetTarget(const glm::vec3& target)
    {
        _target = target;
        _isDirty = true;
    }

private:
    bool _isDirty = false;

    glm::vec3 _position;
    glm::vec3 _target;
    glm::vec3 _up;

    glm::mat4 _viewMatrix;
};
} // namespace uray
```

---
<br>

# To-do Features

- `Unit` 구성 (**Unity**의 `GameObject`와 같은 역할)